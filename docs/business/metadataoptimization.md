# 元数据优化

HybridCLR执行代码过程中并不会额外多占用内存，但加载assembly的元数据占据了大量内存。对于一些内存有较大压力的场合（如微信小游戏），这可能是个问题。
针对此情况，所有商业化版本显著优化了元数据内存。

从几个方面优化内存占用：

- 使用完全泛型共享技术。
- 优化加载补充元数据程序集占据的内存
- 热更新程序集元数据优化
- **TODO** 提供基于原始IL指令的解释器

## 完全泛型共享

完全省去补充元数据内存（大约为dll大小的3-4倍）。缺点是只有2021起才支持完全泛型共享

## 优化加载补充元数据程序集占用内存

加载过程中占用内存由补充元数据dll大小的3-4倍优化到1.2倍左右。该优化对所有Unity版本生效。

## 热更新程序集元数据优化

最大可能地复用元数据，相比社区版本，解决了Il2CppType内存多次分配和泄露的情况。

## 基于原始IL指令的解释器

不再需要运行时转换为寄存器指令集，节省了大量指令内存。缺点是明显降低了解释性能。
