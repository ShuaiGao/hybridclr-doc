# 代码加固

社区版本直接加载原始dll，使得开发者不得不携带和下载原始dll。这些原始dll能够被ILSpy之类的工具反编译
，产生严重的安全问题。即使开发者做了加密也很容易被内存中拦截而获得解密后的dll内容。

我们提供了业内顶级的托管代码加固技术，有效阻止了代码被恶意第三方破解和篡改。


|技术|安全指数|
|-|-|
|元数据加密|:star::star::star::star:|
|结构随机化|:star::star::star:|
|加密随机化|:star::star::star:|
|延迟解密|:star::star::star:|
|虚拟化|:star::star::star::star::star:|
|dll签名|:star::star::star:|

## 元数据加密

|技术|结构随机化|加密随机化|延迟解密|安全指数|
|-|-|-|-|-|
|自定义dll文件结构|✔|||:star:|
|~string流加密||✔||:star::star:|
|~blob流加密||✔||:star::star:|
|~US流加密||✔|✔|:star::star::star:|
|~table流加密|✔|✔|✔|:star::star::star::star:|
|method body数据加密||✔|✔|:star::star::star:|


### 自定义dll文件结构

原始dll文件为PE格式，我们改为自定义文件结构，无法使用ILSpy等反编译工具打开。

支持结构随机化技术，也就是每个版本的dll结构都可以完全不一样，显著增加了破解成本。

### ~string流加密

~string流保存了元数据内部使用的字符串，如类型名、字段名之类。对~string流数据加密使得无法从dll文件中直接获得元数据字符串。

支持加密随机化技术，显著增加了离线破解难度。

### ~blob流加密

~blob流保存了一些复杂元数据（如类型签名）。对~blob流加密使得无法从dll文件中直接获得原始lob数据。

支持加密随机化技术，显著增加了离线破解成本。

### ~US流加密

~US流中保存了用户字符串（即代码中使用的字符串）元数据。

支持加密随机化技术，阻止了破解者从dll文件中直接获得原始~US元数据。

支持延迟解密，阻止破解者使用内存dump技术直接还原出所有数据。

### ~table流加密

~table流保存了大多数结构化的元数据。

支持结构随机化技术，每个版本都使用不同的元数据数据结构，大幅增加了破解成本，即使被破解也无法通过简单的数据移动或者复制还原为原始的~table流结构。

支持加密随机化，显著提升了破解成本。

支持延迟解密，阻止破解者使用内存dump技术直接还原出所有数据。


### method body数据加密

method body中保存了函数体元数据信息。

支持加密随机化，显著提升了破解成本。

支持延迟解密，阻止破解者使用内存dump技术直接还原出所有数据。

## 结构随机化技术

结构随机化技术指每次使用完全不同的文件或者元数据的结构，使得破解者需要每个版本都重新破解，极大提升了破解者的成本。

## 加密随机化技术

加密随机化技术指每次使用完全不同的加密技术，使得破解者需要每个版本都重新破解，极大提升了破解者的成本。

## 延迟解密技术

延迟解密技术指第一次才解密数据，有效防止破解者hook关键路径，直接内存dump出完整的原始数据。

## 虚拟化技术

虚拟化技术指将原始IL指令转换为自定义的寄存器虚拟机指令，有效阻止破解者使用现成的反编译工具分析出原始代码。

虚拟化技术支持指令随机化技术，每个版本指令的指令号和长度都不一样，极大增加了破解者的成本。

## dll签名技术

加载dll时检查dll签名，确保来自官方。恶意第三方即使破解了代码，也无法执行篡改后的代码，极大提升了代码安全性。
